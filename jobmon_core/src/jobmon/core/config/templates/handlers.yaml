# Shared handler templates for jobmon logging
# These reference shared formatters and can be customized in specific configs

handlers:
  # Console handler template for general logging
  console_template: &console_template
    class: logging.StreamHandler
    level: INFO
    formatter: console_default

  # Console handler template for structlog (server-specific)
  console_structlog_template: &console_structlog_template
    class: logging.StreamHandler
    level: INFO
    formatter: structlog_text

  # Console handler template for JSON output (production)
  console_json_template: &console_json_template
    class: logging.StreamHandler
    level: INFO
    formatter: structlog_json

  # Base OTLP handler template (without exporter - to be added in configs)
  otlp_base_template: &otlp_base_template
    class: jobmon.core.otlp.JobmonOTLPLoggingHandler
    level: INFO
    formatter: otlp_default
    # exporter config to be added by importing configs

  # OTLP structlog handler template (without exporter)
  otlp_structlog_template: &otlp_structlog_template
    class: jobmon.core.otlp.JobmonOTLPStructlogHandler
    level: INFO
    formatter: structlog_json
    # exporter config to be added by importing configs

  # Complete OTLP handlers with exporter included (no merge needed)
  otlp_complete_template: &otlp_complete_template
    class: jobmon.core.otlp.JobmonOTLPLoggingHandler
    level: INFO
    formatter: otlp_default
    exporter:
      module: opentelemetry.exporter.otlp.proto.grpc._log_exporter
      class: OTLPLogExporter
      endpoint: http://localhost:4317
      options:
        - ["grpc.max_send_message_length", 16777216]
        - ["grpc.max_receive_message_length", 16777216]
      max_export_batch_size: 8
      export_timeout_millis: 5000
      schedule_delay_millis: 1000
      max_queue_size: 256

  # Complete OTLP structlog handler
  otlp_structlog_complete_template: &otlp_structlog_complete_template
    class: jobmon.core.otlp.JobmonOTLPStructlogHandler
    level: INFO
    formatter: structlog_json
    exporter:
      module: opentelemetry.exporter.otlp.proto.grpc._log_exporter
      class: OTLPLogExporter
      endpoint: http://localhost:4317
      options:
        - ["grpc.max_send_message_length", 16777216]
        - ["grpc.max_receive_message_length", 16777216]
      max_export_batch_size: 8
      export_timeout_millis: 5000
      schedule_delay_millis: 1000
      max_queue_size: 256

# Common handler patterns that can be used directly
common_handlers:
  # Console handlers for different environments
  console_dev:
    <<: *console_template
    level: DEBUG
  
  console_prod:
    <<: *console_template
    level: INFO
    
  console_structlog_dev:
    <<: *console_structlog_template
    level: DEBUG
    
  console_structlog_prod:
    <<: *console_structlog_template
    level: INFO
    
  console_json_dev:
    <<: *console_json_template
    level: DEBUG
    
  console_json_prod:
    <<: *console_json_template
    level: INFO 
# Local development configuration for docker-compose
# Fixed: Using proper GRPC endpoints with TLS for both logs and traces

distributor:
  poll_interval: 10

heartbeat:
  report_by_buffer: 3.1
  task_instance_interval: 90
  workflow_run_interval: 30

http:
  request_timeout: 20
  retries_timeout: 300
  retries_attempts: 10
  route_prefix: /api/v3
  service_url: http://jobmon_backend:80

# Worker Node Config
worker_node:
  command_interrupt_timeout: 10

# Override default logconfig location to use mounted file
logging:
  server_logconfig_file: /app/config/logconfig.example.yaml

# Authentication disabled for local development
auth:
  enabled: false

# Telemetry configuration (replaces otlp section)
telemetry:
  # Environment identifier for telemetry resources
  deployment_environment: dev
  debug: true

  # Distributed tracing configuration
  tracing:
    requester_enabled: false    # Client-side HTTP request tracing  
    server_enabled: false        # Server-side tracing disabled for local dev
    # span_exporter: "grpc_span"  # Commented out since tracing is disabled
    
    exporters:
      # Production GRPC span exporter with proper TLS
      grpc_span:
        module: "opentelemetry.exporter.otlp.proto.grpc.trace_exporter"
        class: "OTLPSpanExporter"
        endpoint: "https://otelcol.aks.scicomp.ihme.washington.edu:443"
        timeout: 30
        insecure: false  # Secure connection
        headers: {}
        compression: "gzip"

cors:
  allowed_origins: "http://localhost:3000"  # Local frontend

db:
  sqlalchemy_database_uri: "sqlite:///jobmon_server/jobmon.db"
  sqlalchemy_connect_args: {}
  pool:
    recycle: 300
    pre_ping: true
    timeout: 20
